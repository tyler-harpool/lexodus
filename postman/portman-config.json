{
  "version": 1.0,
  "globals": {
    "collectionPreRequestScripts": [
      "// Auth: register or login, store access_token",
      "if (pm.collectionVariables.get('access_token')) { return; }",
      "",
      "const baseUrl = pm.environment.get('base_url') || 'http://localhost:8080';",
      "const email = pm.environment.get('test_email');",
      "const password = pm.environment.get('test_password');",
      "const username = pm.environment.get('test_username');",
      "const displayName = pm.environment.get('test_display_name');",
      "",
      "pm.sendRequest({",
      "  url: baseUrl + '/api/v1/auth/register',",
      "  method: 'POST',",
      "  header: { 'Content-Type': 'application/json' },",
      "  body: { mode: 'raw', raw: JSON.stringify({ username, email, password, display_name: displayName }) }",
      "}, function (err, res) {",
      "  if (!err && res.code >= 200 && res.code < 300) {",
      "    const body = res.json();",
      "    pm.collectionVariables.set('access_token', body.access_token);",
      "    if (body.user && body.user.id) pm.collectionVariables.set('test_user_id', body.user.id);",
      "    console.log('Registered and got token');",
      "    return;",
      "  }",
      "  pm.sendRequest({",
      "    url: baseUrl + '/api/v1/auth/login',",
      "    method: 'POST',",
      "    header: { 'Content-Type': 'application/json' },",
      "    body: { mode: 'raw', raw: JSON.stringify({ email, password }) }",
      "  }, function (err2, res2) {",
      "    if (!err2 && res2.code >= 200 && res2.code < 300) {",
      "      const body2 = res2.json();",
      "      pm.collectionVariables.set('access_token', body2.access_token);",
      "      if (body2.user && body2.user.id) pm.collectionVariables.set('test_user_id', body2.user.id);",
      "      console.log('Logged in and got token');",
      "    } else {",
      "      console.error('Auth failed:', err2 || res2.code);",
      "    }",
      "  });",
      "});"
    ],
    "securityOverwrites": {
      "bearer": {
        "token": "{{access_token}}"
      }
    }
  },
  "tests": {
    "contractTests": [
      {
        "openApiOperation": "*::/*",
        "statusSuccess": {
          "enabled": true
        }
      },
      {
        "openApiOperation": "*::/*",
        "responseTime": {
          "enabled": true,
          "maxMs": 5000
        }
      },
      {
        "openApiOperation": "*::/*",
        "contentType": {
          "enabled": true
        }
      },
      {
        "openApiOperation": "*::/*",
        "jsonBody": {
          "enabled": true
        }
      },
      {
        "openApiOperation": "*::/*",
        "schemaValidation": {
          "enabled": true
        }
      }
    ]
  },
  "assignVariables": [
    {
      "openApiOperationId": "register",
      "collectionVariables": [
        {
          "responseBodyProp": "access_token",
          "name": "access_token"
        },
        {
          "responseBodyProp": "user.id",
          "name": "test_user_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_case",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_case_id"
        },
        {
          "responseBodyProp": "case_number",
          "name": "created_case_number"
        }
      ]
    },
    {
      "openApiOperationId": "create_attorney",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_attorney_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_judge",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_judge_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_defendant",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_defendant_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_party",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_party_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_docket_entry",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_docket_entry_id"
        }
      ]
    },
    {
      "openApiOperationId": "submit_filing",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_filing_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_motion",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_motion_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_order",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_order_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_opinion",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_opinion_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_evidence",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_evidence_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_charge",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_charge_id"
        }
      ]
    },
    {
      "openApiOperationId": "schedule_event",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_event_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_deadline",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_deadline_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_sentencing",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_sentencing_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_rule",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_rule_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_conflict_check",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_conflict_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_template",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_template_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_todo",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_todo_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_case_note",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_case_note_id"
        }
      ]
    },
    {
      "openApiOperationId": "create_service_record",
      "collectionVariables": [
        {
          "responseBodyProp": "id",
          "name": "created_service_record_id"
        }
      ]
    }
  ],
  "orderOfOperations": [
    "POST::/api/v1/auth/register",
    "POST::/api/v1/auth/login",
    "GET::/health",

    "POST::/api/cases",
    "GET::/api/cases",
    "GET::/api/cases/{id}",

    "POST::/api/attorneys",
    "GET::/api/attorneys",
    "GET::/api/attorneys/{id}",

    "POST::/api/judges",
    "GET::/api/judges",
    "GET::/api/judges/{id}",

    "POST::/api/defendants",
    "GET::/api/defendants/{id}",

    "POST::/api/parties",
    "GET::/api/parties/{id}",

    "POST::/api/docket/entries",
    "GET::/api/docket/entries/{id}",

    "POST::/api/filings",
    "GET::/api/filings/{id}",

    "POST::/api/motions",
    "GET::/api/motions/{id}",

    "POST::/api/charges",
    "GET::/api/charges/{id}",

    "POST::/api/evidence",
    "GET::/api/evidence/{id}",

    "POST::/api/orders",
    "GET::/api/orders/{id}",

    "POST::/api/opinions",
    "GET::/api/opinions/{id}",

    "POST::/api/deadlines",
    "GET::/api/deadlines/{id}",

    "POST::/api/calendar/events",

    "POST::/api/sentencing",
    "GET::/api/sentencing/{id}",

    "POST::/api/rules",
    "GET::/api/rules/{id}",

    "POST::/api/conflict-checks",

    "POST::/api/templates/orders",
    "GET::/api/templates/orders/{id}",

    "POST::/api/case-notes",
    "GET::/api/case-notes/{id}",

    "POST::/api/todos",
    "GET::/api/todos/{id}",

    "POST::/api/service-records"
  ]
}
